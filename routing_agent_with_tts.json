{
  "name": "routing_agent_with_tts",
  "description": "Query routing agent with TTS streaming output",
  "steps": [
    {
      "id": "get_user_query",
      "type": "input",
      "description": "Get user's query for routing",
      "config": {
        "prompt": "What can I help you with today?"
      },
      "outputs": ["user_query"]
    },
    {
      "id": "analyze_and_route", 
      "type": "llm_chat",
      "description": "Analyze query and determine which agent should handle it",
      "config": {
        "provider": "ollama",
        "model": "gemma3:4b",
        "stream": false,
        "system_message": "You are a query routing agent. Analyze the user's query and respond with EXACTLY ONE WORD: either JAPANESE, HOME_ASSISTANT, or GENERAL.\n\nROUTING RULES:\n\nJAPANESE - Route here ONLY for:\n- Japanese language learning (grammar, vocabulary, pronunciation)\n- Japanese translation requests\n- Questions about Japanese writing systems (hiragana, katakana, kanji)\n- Japanese cultural questions related to language\n- Keywords: japanese, japan, romaji, hiragana, katakana, kanji, grammar, translate, conjugation\n\nHOME_ASSISTANT - Route here ONLY for:\n- Smart home device control (lights, switches, sensors)\n- Home automation requests\n- Device status checks\n- Keywords: light, switch, turn on, turn off, brightness, automation, device, smart home\n\nGENERAL - Route here for everything else:\n- Programming questions\n- Science, math, general knowledge\n- Cooking, health, entertainment\n- Technical explanations\n- Any topic not specifically Japanese language or smart home\n\nIMPORTANT:\n- Respond with ONLY the agent name\n- No explanations, no extra text\n- If unsure, choose GENERAL\n- Do not explain your reasoning\n\nExamples:\nUser: \"How do I say hello in Japanese?\" ‚Üí JAPANESE\nUser: \"Turn on the bedroom light\" ‚Üí HOME_ASSISTANT\nUser: \"What is machine learning?\" ‚Üí GENERAL\nUser: \"Show me all lights\" ‚Üí HOME_ASSISTANT\nUser: \"Japanese grammar help\" ‚Üí JAPANESE\nUser: \"How to cook pasta\" ‚Üí GENERAL",
        "temperature": 0.1,
        "max_tokens": 10
      },
      "inputs": {
        "message": {
          "from_step": "get_user_query",
          "field": "user_query"
        }
      },
      "outputs": ["response"]
    },
    {
      "id": "generate_routing_response",
      "type": "llm_chat",
      "description": "Generate a friendly response about the routing decision",
      "config": {
        "provider": "ollama",
        "model": "gemma3:4b",
        "stream": true,
        "system_message": "You are a helpful assistant that explains routing decisions. Based on the routing decision, provide a brief (1-2 sentences) friendly explanation of where the query is being routed and why. Be conversational and helpful.",
        "temperature": 0.7,
        "max_tokens": 100
      },
      "inputs": {
        "message": {
          "from_step": "analyze_and_route",
          "field": "response"
        },
        "context": {
          "from_step": "get_user_query",
          "field": "user_query"
        }
      },
      "outputs": ["streaming_response"]
    },
    {
      "id": "text_to_speech",
      "type": "tts",
      "description": "Convert routing response to speech using Fish Speech",
      "config": {
        "provider": "fish_speech",
        "voice": "sonnet29",
        "output_format": "wav"
      },
      "inputs": {
        "text": {
          "from_step": "generate_routing_response",
          "field": "streaming_response"
        }
      },
      "outputs": ["audio_file_path", "audio_data"]
    },
    {
      "id": "format_routing_result",
      "type": "output",
      "description": "Format the routing decision", 
      "config": {
        "format": "text",
        "template": "ü§ñ Router: {routing_explanation}\n\nüìç Routing to: {routing_decision} agent\nüîä Audio file: {audio_file}"
      },
      "inputs": {
        "routing_decision": {
          "from_step": "analyze_and_route",
          "field": "response"
        },
        "routing_explanation": {
          "from_step": "generate_routing_response",  
          "field": "streaming_response"
        },
        "audio_file": {
          "from_step": "text_to_speech",
          "field": "audio_file_path"
        }
      }
    }
  ]
}